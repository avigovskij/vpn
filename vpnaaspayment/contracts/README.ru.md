# Смарт-контракт распределенного хранилища .ovpn файлов для VPN

## Общая информация
Смарт-контракт реализован на языке Tact для блокчейн-платформы TON. Смарт-контракт представляет из себя платежную систему с распределенным хранилищем данных.

### Платежная система
Для реализации платежной системы в данном смарт-контракте используется валюта TON без выпуска собственных Jetton или NFT-токенов.

### Распределенная система
Распределенность системы заключается в микросервисном подходе к хранилищу данных. Так, вместо использования одного смарт-контракта с постоянно расширяющимися данными, предлагается использовать один мастер-контракт, который будет “порождать” другие смарт-контракты, хранящие данные. Таким образом, можно построить безлимитное хранилище данных, где мастер-контракт будет порождать остальные смарт-контракты с целью дальнейшей записи данных в эти смарт-контракты.

## Состав смарт-контракта
* [ovpn_storage_master.tact](./ovpn_storage_master.tact) – Мастер-контракт, осуществляющий деплой и модерацию других контрактов
* [ovpn_storage_entry.tact](./ovpn_storage_entry.tact) - Порождаемый контракт

## Взаимодействие со смарт-контрактом
Для взаимодействия со смарт-контрактом предусмотрено несколько сценариев, зависящих от роли взаимодействующего со смарт-контрактом кошелька в системе. Расмотрим две роли, присутствующие в системе:

* master wallet – кошелек, который произвел деплой смарт-контракта в сеть TON. Данному пользователю доступны следующие методы:
    * OVPNStorageMaster.init – метод деплоя смарт-контракта (используется не напрямую, а через Blueprint. TODO: проработать DevOPS процесс непрерывной интеграции)
    * OVPNStorageMaster.receive(ovpnFileResponse: ExternalOVPNFile) – метод для заполнения смарт-контракта полезной нагрузкой. Доступен только master wallet'у
* user walllet – кошелек, который может произвести запрос на создание записи в распределенной системе хранения данных. Данному пользователю доступны следующие методы:
    * OVPNStorageMaster.receive("ovpn_request") – метод, вызываемый простой текстовой транзакцией и является запросом на создание ячейки данных

## Взаимодействие между смарт-контрактами
Взаимодействие между смарт-контрактами осуществляется внутренними сообщениями, формат которых описан в файле [./messages.tact](./messages.tact). Где:
* ExternalOVPNFile - сообщение, принимаемое мастер-контрактом от прокси-сервера
* InternalOVPNFile – сообщение, принимаемое внутренним смарт-контрактом от мастер-контракта

## Тестирование смарт-контракта
Тесты смарт-контрактов располагаются в директории [../tests](../tests/). Для запуска тестов можно использовать команду:
```shell
    npm run test
```
